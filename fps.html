<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Анализ производительности игры VYRUS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .impact-high {
            background-color: #ffcdd2;
        }
        .impact-medium {
            background-color: #ffe0b2;
        }
        .impact-low {
            background-color: #c8e6c9;
        }
        .section {
            margin: 30px 0;
        }
        .summary {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Анализ производительности игры VYRUS</h1>
        
        <div class="summary">
            <h2>Краткое резюме</h2>
            <p>Основные причины тормозов в игре VYRUS:</p>
            <ol>
                <li><strong>Фаза боя</strong> - до 35% снижения FPS из-за интенсивных вычислений соседних клеток</li>
                <li><strong>Рендеринг Canvas</strong> - до 25% снижения FPS из-за отрисовки всех клеток каждый кадр</li>
                <li><strong>Визуальные эффекты</strong> - до 20% снижения FPS при высокой скорости симуляции</li>
                <li><strong>Высокая частота обновлений</strong> - до 15% снижения FPS при скорости 64x</li>
                <li><strong>Система возрастов клеток</strong> - полностью удалена для улучшения производительности</li>
            </ol>
        </div>

        <div class="section">
            <h2>1. Вычисления в Web Worker</h2>
            <table>
                <thead>
                    <tr>
                        <th>Компонент</th>
                        <th>Описание</th>
                        <th>Влияние на FPS</th>
                        <th>Примечания</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="impact-high">
                        <td>Фаза боя (Phase 0)</td>
                        <td>Проверка соседних клеток для каждой занятой клетки, вычисление шансов атаки/защиты</td>
                        <td>-30% до -35%</td>
                        <td>Самый ресурсоемкий компонент, особенно при большом количестве занятых клеток</td>
                    </tr>
                    <tr class="impact-medium">
                        <td>Фаза расширения (Phase 2)</td>
                        <td>Расчет попыток расширения, проверка условий для разных типов вирусов</td>
                        <td>-15% до -20%</td>
                        <td>Зависит от параметров вирусов, особенно при высоких значениях скрытности и мобильности</td>
                    </tr>
                    <tr class="impact-low">
                        <td>Система возрастов клеток</td>
                        <td>Обновление возраста всех клеток каждый N ход</td>
                        <td>-3% до -5%</td>
                        <td>При оптимизации обновляется каждые 5 ходов, а не каждый ход</td>
                    </tr>
                    <tr class="impact-medium">
                        <td>Подсчет территории</td>
                        <td>Подсчет количества клеток для каждого игрока</td>
                        <td>-5% до -8%</td>
                        <td>Выполняется каждый ход для всех 2450 клеток (70x35)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>2. Рендеринг на Canvas</h2>
            <table>
                <thead>
                    <tr>
                        <th>Компонент</th>
                        <th>Описание</th>
                        <th>Влияние на FPS</th>
                        <th>Примечания</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="impact-medium">
                        <td>Отрисовка клеток</td>
                        <td>Рендеринг всех клеток на поле (до 2450 клеток)</td>
                        <td>-15% до -25%</td>
                        <td>Даже при оптимизации через отслеживание изменений, при активной игре большинство клеток меняется каждый ход</td>
                    </tr>
                    <tr class="impact-medium">
                        <td>Визуальные эффекты клеток</td>
                        <td>Случайные смещения позиций, вариации размеров, градиенты</td>
                        <td>-8% до -12%</td>
                        <td>Вычисляются для каждой клетки, особенно затратны при высоких значениях параметров</td>
                    </tr>
                    <tr class="impact-low">
                        <td>Параметрические эффекты</td>
                        <td>Дополнительные элементы, основанные на параметрах вируса (blob, линии, градиенты)</td>
                        <td>-5% до -8%</td>
                        <td>Добавляются только при высоких значениях соответствующих параметров (>8)</td>
                    </tr>
                    <tr class="impact-low">
                        <td>Обработка изменений</td>
                        <td>Определение клеток, которые изменились с последнего кадра</td>
                        <td>-2% до -5%</td>
                        <td>При оптимизации сверху этой таблицы, этот показатель может улучшиться</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>3. Визуальные эффекты</h2>
            <table>
                <thead>
                    <tr>
                        <th>Тип эффекта</th>
                        <th>Описание</th>
                        <th>Влияние на FPS</th>
                        <th>Частота появления</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="impact-medium">
                        <td>Эффекты взаимодействия</td>
                        <td>Атака, защита, захват территории</td>
                        <td>-8% до -15%</td>
                        <td>Появляются при каждом взаимодействии между клетками</td>
                    </tr>
                    <tr class="impact-medium">
                        <td>Волновые эффекты</td>
                        <td>Распространение энергии, волны при захвате</td>
                        <td>-5% до -10%</td>
                        <td>Появляются при захвате территории и других событиях</td>
                    </tr>
                    <tr class="impact-low">
                        <td>Эффекты расширения</td>
                        <td>Источник, путь и цель расширения</td>
                        <td>-3% до -7%</td>
                        <td>Появляются при успешном расширении клеток</td>
                    </tr>
                    <tr class="impact-high">
                        <td>Накопление эффектов</td>
                        <td>Общее количество активных эффектов</td>
                        <td>-10% до -20%</td>
                        <td>При высокой скорости симуляции количество эффектов быстро растет</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>4. Частота обновлений</h2>
            <table>
                <thead>
                    <tr>
                        <th>Скорость симуляции</th>
                        <th>Интервал обновления</th>
                        <th>Влияние на FPS</th>
                        <th>Примечания</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="impact-low">
                        <td>1x</td>
                        <td>400мс</td>
                        <td>Базовый уровень</td>
                        <td>Минимальное влияние на производительность</td>
                    </tr>
                    <tr class="impact-medium">
                        <td>16x</td>
                        <td>25мс</td>
                        <td>-5% до -10%</td>
                        <td>Умеренное влияние на производительность</td>
                    </tr>
                    <tr class="impact-high">
                        <td>64x</td>
                        <td>~6.25мс</td>
                        <td>-10% до -15%</td>
                        <td>Максимальное влияние, близко к пределу возможностей многих устройств</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>5. Состояние игры и обновления</h2>
            <table>
                <thead>
                    <tr>
                        <th>Компонент</th>
                        <th>Описание</th>
                        <th>Влияние на FPS</th>
                        <th>Примечания</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="impact-medium">
                        <td>Zustand Store</td>
                        <td>Обновление глобального состояния игры</td>
                        <td>-5% до -10%</td>
                        <td>Частые обновления могут вызывать лишние перерисовки компонентов</td>
                    </tr>
                    <tr class="impact-low">
                        <td>useEffect зависимости</td>
                        <td>Перезапуск эффектов при изменении gameState</td>
                        <td>-2% до -5%</td>
                        <td>gameState передается в качестве зависимости во многих useEffect</td>
                    </tr>
                    <tr class="impact-low">
                        <td>Компонент Game</td>
                        <td>Основной компонент управления игрой</td>
                        <td>-3% до -5%</td>
                        <td>Может перерисовываться при каждом обновлении состояния</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>6. Рекомендации по оптимизации</h2>
            <ul>
                <li><strong>Оптимизация Web Worker</strong>: 
                    <ul>
                        <li>Уменьшить количество вычислений в фазе боя, возможно, используя более эффективный алгоритм для определения соседних клеток</li>
                        <li>Оптимизировать фазу расширения, особенно для случаев с высокими значениями параметров</li>
                        <li>Реализовать оптимизации для фазы боя:</li>
                        <ul>
                            <li>Использовать пространственные структуры данных (например, сетку или деревья) для быстрого поиска соседей</li>
                            <li>Ограничивать количество проверяемых клеток с помощью эвристик</li>
                            <li>Предварительно вычислять и кэшировать часто используемые значения (например, факторы атаки/защиты)</li>
                            <li>Оптимизировать алгоритмы выбора целей для атаки</li>
                        </ul>
                    </ul>
                </li>
                <li><strong>Оптимизация рендеринга</strong>:
                    <ul>
                        <li>Улучшить алгоритм определения измененных клеток</li>
                        <li>Оптимизировать вычисления для визуальных эффектов на стороне рендеринга</li>
                        <li>Рассмотреть возможность использования WebGL вместо 2D Canvas</li>
                    </ul>
                </li>
                <li><strong>Ограничение визуальных эффектов</strong>:
                    <ul>
                        <li>Уменьшить количество создаваемых визуальных эффектов при высоких скоростях симуляции</li>
                        <li>Реализовать систему приоритетов для визуальных эффектов</li>
                    </ul>
                </li>
                <li><strong>Оптимизация обновления состояния</strong>:
                    <ul>
                        <li>Разделить часто обновляемые данные от редко обновляемых</li>
                        <li>Использовать мемоизацию для вычисляемых значений</li>
                    </ul>
                </li>
                <li><strong>Адаптивная частота обновлений</strong>:
                    <ul>
                        <li>Реализовать адаптивную систему, которая автоматически снижает скорость симуляции при падении FPS</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</body>
</html>